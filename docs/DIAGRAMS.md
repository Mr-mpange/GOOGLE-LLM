# LLM Guardian - Architecture Diagrams

Visual representations of the LLM Guardian architecture.

## System Architecture

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              USER LAYER                                  │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────┐   │
│  │                    React Frontend (Vite)                        │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐        │   │
│  │  │   Prompt     │  │   Metrics    │  │   Alerts     │        │   │
│  │  │   Tester     │  │   Panel      │  │   Panel      │        │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘        │   │
│  │  ┌──────────────────────────────────────────────────┐        │   │
│  │  │          Charts Panel (Recharts)                  │        │   │
│  │  └──────────────────────────────────────────────────┘        │   │
│  └────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
                                  │
                                  │ HTTPS / REST API
                                  ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         APPLICATION LAYER                                │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────┐   │
│  │              Google Cloud Run (Node.js + Express)              │   │
│  │                                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────┐  │   │
│  │  │  Request Handler                                         │  │   │
│  │  │  • Input validation                                      │  │   │
│  │  │  • Request tracking (UUID)                               │  │   │
│  │  │  • Error handling                                        │  │   │
│  │  └─────────────────────────────────────────────────────────┘  │   │
│  │                                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────┐  │   │
│  │  │  Security Module                                         │  │   │
│  │  │  • Prompt injection detection (15+ patterns)             │  │   │
│  │  │  • PII detection                                         │  │   │
│  │  │  • Safety score calculation                              │  │   │
│  │  │  • Policy violation checks                               │  │   │
│  │  └─────────────────────────────────────────────────────────┘  │   │
│  │                                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────┐  │   │
│  │  │  Telemetry Logger                                        │  │   │
│  │  │  • Structured logging                                    │  │   │
│  │  │  • Metric collection                                     │  │   │
│  │  │  • Async streaming                                       │  │   │
│  │  └─────────────────────────────────────────────────────────┘  │   │
│  └────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
                    │                              │
                    │                              │
        ┌───────────┘                              └──────────────┐
        │                                                          │
        ▼                                                          ▼
┌──────────────────────┐                          ┌──────────────────────┐
│    AI LAYER          │                          │  OBSERVABILITY       │
│                      │                          │  LAYER               │
│  Vertex AI           │                          │                      │
│  ┌────────────────┐  │                          │  Datadog Platform    │
│  │  Gemini Pro    │  │                          │  ┌────────────────┐  │
│  │                │  │                          │  │  Log Intake    │  │
│  │  • Generation  │  │                          │  │  API           │  │
│  │  • Safety      │  │                          │  └────────────────┘  │
│  │    Filters     │  │                          │  ┌────────────────┐  │
│  │  • Token       │  │                          │  │  Metrics API   │  │
│  │    Counting    │  │                          │  └────────────────┘  │
│  └────────────────┘  │                          │  ┌────────────────┐  │
│                      │                          │  │  APM Traces    │  │
└──────────────────────┘                          │  └────────────────┘  │
                                                  │  ┌────────────────┐  │
                                                  │  │  Security      │  │
                                                  │  │  Monitoring    │  │
                                                  │  └────────────────┘  │
                                                  └──────────────────────┘
                                                            │
                                                            ▼
                                                  ┌──────────────────────┐
                                                  │  DETECTION &         │
                                                  │  ALERTING            │
                                                  │                      │
                                                  │  ┌────────────────┐  │
                                                  │  │  Detection     │  │
                                                  │  │  Rules (5)     │  │
                                                  │  └────────────────┘  │
                                                  │  ┌────────────────┐  │
                                                  │  │  Incident      │  │
                                                  │  │  Management    │  │
                                                  │  └────────────────┘  │
                                                  │  ┌────────────────┐  │
                                                  │  │  Notifications │  │
                                                  │  │  • Slack       │  │
                                                  │  │  • Email       │  │
                                                  │  │  • PagerDuty   │  │
                                                  │  └────────────────┘  │
                                                  └──────────────────────┘
```

## Request Flow Diagram

```
┌──────────┐
│  User    │
└────┬─────┘
     │
     │ 1. Submit Prompt
     ▼
┌─────────────────┐
│  React Frontend │
└────┬────────────┘
     │
     │ 2. POST /api/prompt
     ▼
┌─────────────────────────────────────┐
│  Cloud Run API                      │
│  ┌───────────────────────────────┐  │
│  │ 3. Validate Input             │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │ 4. Security Check             │  │
│  │    • Injection detection      │  │
│  │    • PII check                │  │
│  └───────────────────────────────┘  │
│           │                          │
│           │ If malicious             │
│           ├──────────────────────┐   │
│           │                      │   │
│           │ If safe              │   │
│           ▼                      ▼   │
│  ┌───────────────────┐  ┌──────────────────┐
│  │ 5. Call Vertex AI │  │ Block & Alert    │
│  └───────────────────┘  └──────────────────┘
│           │                      │   │
│           ▼                      │   │
│  ┌───────────────────┐           │   │
│  │ 6. Get Response   │           │   │
│  └───────────────────┘           │   │
│           │                      │   │
│           ▼                      │   │
│  ┌───────────────────┐           │   │
│  │ 7. Calculate      │           │   │
│  │    • Tokens       │           │   │
│  │    • Cost         │           │   │
│  │    • Safety       │           │   │
│  └───────────────────┘           │   │
│           │                      │   │
│           ▼                      ▼   │
│  ┌─────────────────────────────────┐│
│  │ 8. Stream to Datadog            ││
│  │    • Logs                       ││
│  │    • Metrics                    ││
│  │    • Security Signals           ││
│  └─────────────────────────────────┘│
│           │                          │
└───────────┼──────────────────────────┘
            │
            │ 9. Return Response
            ▼
┌─────────────────┐
│  React Frontend │
│  • Display text │
│  • Show metrics │
│  • Update charts│
└─────────────────┘
```

## Data Flow Diagram

```
┌─────────────────────────────────────────────────────────────┐
│                    REQUEST DATA                              │
│  {                                                           │
│    prompt: "User input",                                     │
│    userId: "user-123",                                       │
│    sessionId: "session-abc"                                  │
│  }                                                           │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│                 ENRICHED TELEMETRY                           │
│  {                                                           │
│    requestId: "uuid",                                        │
│    prompt: "User input",                                     │
│    response: "AI response",                                  │
│    tokensIn: 125,                                            │
│    tokensOut: 450,                                           │
│    totalTokens: 575,                                         │
│    latency: 1834,                                            │
│    cost: 0.000256,                                           │
│    safetyScore: 0.98,                                        │
│    model: "gemini-pro",                                      │
│    userId: "user-123",                                       │
│    sessionId: "session-abc",                                 │
│    timestamp: "2024-12-03T10:30:00Z"                         │
│  }                                                           │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│                    DATADOG LOGS                              │
│  • Full request/response context                             │
│  • Searchable by any field                                   │
│  • Retention: 15 days                                        │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                   DATADOG METRICS                            │
│  • llm.request.count: 1                                      │
│  • llm.request.latency: 1834                                 │
│  • llm.tokens.input: 125                                     │
│  • llm.tokens.output: 450                                    │
│  • llm.tokens.total: 575                                     │
│  • llm.cost: 0.000256                                        │
│  • llm.safety.score: 0.98                                    │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                 DATADOG DASHBOARDS                           │
│  • Real-time visualization                                   │
│  • Historical trends                                         │
│  • Aggregations and analytics                               │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                  DETECTION RULES                             │
│  • Evaluate metrics and logs                                 │
│  • Trigger on thresholds                                     │
│  • Create incidents                                          │
└─────────────────────────────────────────────────────────────┘
```

## Security Flow Diagram

```
┌──────────────┐
│ User Prompt  │
└──────┬───────┘
       │
       ▼
┌─────────────────────────────────────┐
│  Prompt Injection Detection         │
│  ┌───────────────────────────────┐  │
│  │ Check patterns:               │  │
│  │ • "Ignore instructions"       │  │
│  │ • "You are now..."            │  │
│  │ • System prompt manipulation  │  │
│  │ • 12+ more patterns           │  │
│  └───────────────────────────────┘  │
└────────┬────────────────────────────┘
         │
         ├─── Malicious? ───┐
         │                  │
         NO                YES
         │                  │
         ▼                  ▼
┌─────────────────┐  ┌──────────────────────┐
│ PII Detection   │  │ Block Request        │
│ • Email         │  │ • Return 403         │
│ • Phone         │  │ • Log incident       │
│ • SSN           │  │ • Send alert         │
└────────┬────────┘  └──────────────────────┘
         │                  │
         ├─── PII? ───┐     │
         │            │     │
         NO          YES    │
         │            │     │
         ▼            ▼     │
┌─────────────────┐  │     │
│ Send to Vertex  │  │     │
│ AI              │  │     │
└────────┬────────┘  │     │
         │            │     │
         ▼            │     │
┌─────────────────┐  │     │
│ Get Response    │  │     │
└────────┬────────┘  │     │
         │            │     │
         ▼            │     │
┌─────────────────┐  │     │
│ Safety Check    │  │     │
│ • Hate speech   │  │     │
│ • Dangerous     │  │     │
│ • Explicit      │  │     │
│ • Harassment    │  │     │
└────────┬────────┘  │     │
         │            │     │
         ├─ Unsafe? ─┤     │
         │            │     │
         NO          YES    │
         │            │     │
         ▼            ▼     ▼
┌─────────────────────────────────┐
│ Log to Datadog                  │
│ • Normal log (if safe)          │
│ • Security signal (if unsafe)   │
└─────────────────────────────────┘
```

## Deployment Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    GOOGLE CLOUD PLATFORM                     │
│                                                              │
│  ┌────────────────────────────────────────────────────┐    │
│  │  Cloud Run                                          │    │
│  │  ┌──────────────────────────────────────────────┐  │    │
│  │  │  llm-guardian-api                            │  │    │
│  │  │  • Auto-scaling: 0-100 instances             │  │    │
│  │  │  • CPU: 1 vCPU                               │  │    │
│  │  │  • Memory: 512 MB                            │  │    │
│  │  │  • Concurrency: 80 requests/instance         │  │    │
│  │  └──────────────────────────────────────────────┘  │    │
│  └────────────────────────────────────────────────────┘    │
│                                                              │
│  ┌────────────────────────────────────────────────────┐    │
│  │  Secret Manager                                     │    │
│  │  • DATADOG_API_KEY                                  │    │
│  │  • VERTEX_AI_CREDENTIALS                            │    │
│  └────────────────────────────────────────────────────┘    │
│                                                              │
│  ┌────────────────────────────────────────────────────┐    │
│  │  Vertex AI                                          │    │
│  │  • Gemini Pro model                                 │    │
│  │  • us-central1 region                               │    │
│  └────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    VERCEL / FIREBASE                         │
│  ┌────────────────────────────────────────────────────┐    │
│  │  Frontend Hosting                                   │    │
│  │  • Static assets                                    │    │
│  │  • CDN distribution                                 │    │
│  │  • SSL/TLS                                          │    │
│  └────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                        DATADOG                               │
│  ┌────────────────────────────────────────────────────┐    │
│  │  Logs                                               │    │
│  │  • 15-day retention                                 │    │
│  │  • Full-text search                                 │    │
│  └────────────────────────────────────────────────────┘    │
│  ┌────────────────────────────────────────────────────┐    │
│  │  Metrics                                            │    │
│  │  • 15-month retention                               │    │
│  │  • Custom metrics                                   │    │
│  └────────────────────────────────────────────────────┘    │
│  ┌────────────────────────────────────────────────────┐    │
│  │  Dashboards (3)                                     │    │
│  │  • Telemetry                                        │    │
│  │  • Performance                                      │    │
│  │  • Security                                         │    │
│  └────────────────────────────────────────────────────┘    │
│  ┌────────────────────────────────────────────────────┐    │
│  │  Monitors (5)                                       │    │
│  │  • Detection rules                                  │    │
│  │  • Alerting                                         │    │
│  └────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

## Component Interaction Diagram

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   Frontend   │────▶│   Backend    │────▶│  Vertex AI   │
│   (React)    │◀────│  (Node.js)   │◀────│   (Gemini)   │
└──────────────┘     └──────┬───────┘     └──────────────┘
                            │
                            │ Async
                            ▼
                     ┌──────────────┐
                     │   Datadog    │
                     │   Platform   │
                     └──────┬───────┘
                            │
                            ▼
                     ┌──────────────┐
                     │  Detection   │
                     │    Rules     │
                     └──────┬───────┘
                            │
                            ▼
                     ┌──────────────┐
                     │  Incidents   │
                     │  & Alerts    │
                     └──────┬───────┘
                            │
                            ▼
                     ┌──────────────┐
                     │ Notifications│
                     │ (Slack/Email)│
                     └──────────────┘
```

These diagrams provide a comprehensive visual understanding of LLM Guardian's architecture, data flow, security mechanisms, and deployment structure.
